const a0_0xf168e0=a0_0x5678;(function(_0x2e5880,_0x2b6964){const _0x10d82e=a0_0x5678,_0x3673dc=_0x2e5880();while(!![]){try{const _0x41167b=parseInt(_0x10d82e(0xf0))/0x1+parseInt(_0x10d82e(0x10d))/0x2*(parseInt(_0x10d82e(0xe7))/0x3)+parseInt(_0x10d82e(0x108))/0x4*(-parseInt(_0x10d82e(0x105))/0x5)+-parseInt(_0x10d82e(0xe8))/0x6*(-parseInt(_0x10d82e(0x10c))/0x7)+parseInt(_0x10d82e(0xed))/0x8+-parseInt(_0x10d82e(0x10b))/0x9+parseInt(_0x10d82e(0xfe))/0xa;if(_0x41167b===_0x2b6964)break;else _0x3673dc['push'](_0x3673dc['shift']());}catch(_0x555c96){_0x3673dc['push'](_0x3673dc['shift']());}}}(a0_0x45dc,0x23a43));function a0_0x45dc(){const _0x285b23=['readSubmission','createFile','deleteDocument','listDocuments','eligiblePoints','25oYKxUc','6945a6580034b3c579df','6945a9930023af1a7139','226492vOpmVY','get','reduce','759807BHpuTI','7CjHmok','227734SedxKh','file','getDocument','zybookStudents','3HzbDra','333594zYGRgq','unique','length','update','createDocument','670384fAaswm','$id','canvasId','169409DpFlhh','equal','getUser','name','updateDocument','documents','listSubmissions','submissionId','set','updateSubmissionGraded','fileId','push','catch','deduction','908520ksOEkj','user'];a0_0x45dc=function(){return _0x285b23;};return a0_0x45dc();}import{auth}from'./auth.js';function a0_0x5678(_0x2597a4,_0x3606fb){const _0x45dce8=a0_0x45dc();return a0_0x5678=function(_0x567836,_0x4b84fd){_0x567836=_0x567836-0xe4;let _0x51641a=_0x45dce8[_0x567836];return _0x51641a;},a0_0x5678(_0x2597a4,_0x3606fb);}import{client,Databases,Storage,ID,Permission,Role,Query}from'./appwrite.js';const DATABASE_ID=a0_0xf168e0(0x106),SUBMISSIONS_COLLECTION_ID='submissions',FIXES_COLLECTION_ID='fixes',ZYBOOK_STUDENTS_COLLECTION_ID=a0_0xf168e0(0xe6),STORAGE_BUCKET_ID=a0_0xf168e0(0x107);class SubmissionService{#databases;#storage;constructor(_0x523b31){this.#databases=new Databases(_0x523b31),this.#storage=new Storage(_0x523b31);}async['createSubmission'](_0xa32437,_0x443736){const _0x2dbf1c=this.#submissionId(_0xa32437);await this.#deleteSubmissionGroup(_0x2dbf1c);const _0x4becb6=await this.#uploadFiles(_0x443736),_0x4ba09a=await this.#createFixes(_0x2dbf1c,_0x443736,_0x4becb6),_0x2a30cb=this.#computeSummary(_0x4ba09a),_0x4ab791=await this.#docPermissions();return await this.#databases['createDocument'](DATABASE_ID,SUBMISSIONS_COLLECTION_ID,_0x2dbf1c,{..._0xa32437,..._0x2a30cb},_0x4ab791),_0x2dbf1c;}async[a0_0xf168e0(0x100)](_0x343d84){const _0x34ac3d=a0_0xf168e0,_0x4187de=await this.#databases[_0x34ac3d(0xe5)](DATABASE_ID,SUBMISSIONS_COLLECTION_ID,_0x343d84),_0x2b2914=await this.#getFixes(_0x343d84);return{'submission':_0x4187de,'fixes':_0x2b2914};}async['deleteSubmission'](_0x1ef92a){await this.#deleteSubmissionGroup(_0x1ef92a);}async[a0_0xf168e0(0xf9)](_0x2b9407,_0x1e9d97){const _0x263f37=a0_0xf168e0;return this.#databases[_0x263f37(0xf4)](DATABASE_ID,SUBMISSIONS_COLLECTION_ID,_0x2b9407,{'graded':_0x1e9d97});}async[a0_0xf168e0(0xf6)](){const _0x5e35f6=a0_0xf168e0,_0x577323=await this.#databases[_0x5e35f6(0x103)](DATABASE_ID,SUBMISSIONS_COLLECTION_ID),_0x40e7e7=[];for(const _0x303ef7 of _0x577323['documents']){const _0x59d24c=await this.#getFixes(_0x303ef7[_0x5e35f6(0xee)]);_0x40e7e7['push']({..._0x303ef7,'fixes':_0x59d24c[_0x5e35f6(0xf5)]});}return _0x40e7e7;}async['zybookStudent'](_0x4a5cdb){const _0x50e37e=a0_0xf168e0,_0x53a977=await this.#databases[_0x50e37e(0x103)](DATABASE_ID,ZYBOOK_STUDENTS_COLLECTION_ID,[Query[_0x50e37e(0xf1)](_0x50e37e(0xef),_0x4a5cdb)]);return _0x53a977[_0x50e37e(0xf5)][0x0]??null;}#submissionId({studentID:_0x27a359,projectNumber:_0x4a07c4}){return _0x27a359+'-'+_0x4a07c4;}async #docPermissions(){const _0x390525=a0_0xf168e0;let _0x25e1fb=[];const _0x10af0f=await auth[_0x390525(0xf2)]();if(_0x10af0f){const _0x30e417=_0x10af0f[_0x390525(0xee)];_0x25e1fb=[Permission['read'](Role['user'](_0x30e417)),Permission[_0x390525(0xeb)](Role[_0x390525(0xff)](_0x30e417)),Permission['delete'](Role[_0x390525(0xff)](_0x30e417))];}return _0x25e1fb;}async #uploadFiles(_0x19afbf){const _0x5e823e=a0_0xf168e0,_0xaf6e3c=new Map();for(const _0x7907fc of _0x19afbf){if(_0xaf6e3c['has'](_0x7907fc[_0x5e823e(0xe4)][_0x5e823e(0xf3)]))continue;const _0x108d05=await this.#docPermissions(),_0x187947=await this.#storage[_0x5e823e(0x101)](STORAGE_BUCKET_ID,ID[_0x5e823e(0xe9)](),_0x7907fc[_0x5e823e(0xe4)],_0x108d05);_0xaf6e3c[_0x5e823e(0xf8)](_0x7907fc[_0x5e823e(0xe4)][_0x5e823e(0xf3)],_0x187947);}return _0xaf6e3c;}async #createFixes(_0x3b58a2,_0x457e62,_0x2ec2ea){const _0x35fe2e=a0_0xf168e0,_0x10a555=[];for(const _0x39c00c of _0x457e62){const _0x1c67cb=_0x2ec2ea[_0x35fe2e(0x109)](_0x39c00c[_0x35fe2e(0xe4)][_0x35fe2e(0xf3)]),_0x5ed120=await this.#docPermissions(),_0x346f7c=await this.#databases[_0x35fe2e(0xec)](DATABASE_ID,FIXES_COLLECTION_ID,ID[_0x35fe2e(0xe9)](),{'submissionId':_0x3b58a2,'fileName':_0x1c67cb[_0x35fe2e(0xf3)],'fileId':_0x1c67cb[_0x35fe2e(0xee)],'lineNumber':_0x39c00c['lineNumber'],'deduction':_0x39c00c[_0x35fe2e(0xfd)],'eligiblePoints':_0x39c00c[_0x35fe2e(0x104)]},_0x5ed120);_0x10a555[_0x35fe2e(0xfb)](_0x346f7c);}return _0x10a555;}async #getFixes(_0x49bc74){const _0x451f33=a0_0xf168e0;return this.#databases[_0x451f33(0x103)](DATABASE_ID,FIXES_COLLECTION_ID,[Query[_0x451f33(0xf1)](_0x451f33(0xf7),_0x49bc74)]);}async #deleteSubmissionGroup(_0x4630cf){const _0x239fc5=a0_0xf168e0,_0x573747=await this.#getFixes(_0x4630cf);for(const _0x36081b of _0x573747[_0x239fc5(0xf5)]){await this.#storage['deleteFile'](STORAGE_BUCKET_ID,_0x36081b[_0x239fc5(0xfa)])[_0x239fc5(0xfc)](()=>{});}for(const _0x38bb56 of _0x573747['documents']){await this.#databases['deleteDocument'](DATABASE_ID,FIXES_COLLECTION_ID,_0x38bb56['$id'])[_0x239fc5(0xfc)](()=>{});}await this.#databases[_0x239fc5(0x102)](DATABASE_ID,SUBMISSIONS_COLLECTION_ID,_0x4630cf)[_0x239fc5(0xfc)](()=>{});}#computeSummary(_0x4b65fc){const _0x2dbf37=a0_0xf168e0;return{'fixCount':_0x4b65fc[_0x2dbf37(0xea)],'totalEligible':_0x4b65fc[_0x2dbf37(0x10a)]((_0x3fcd5b,_0x17b3bb)=>_0x3fcd5b+_0x17b3bb[_0x2dbf37(0x104)],0x0),'totalDeductions':_0x4b65fc[_0x2dbf37(0x10a)]((_0x1599e4,_0x1a0136)=>_0x1599e4+_0x1a0136[_0x2dbf37(0xfd)],0x0)};}}export const db=new SubmissionService(client);