function a0_0x232d(_0x24534f,_0x745262){const _0x51136c=a0_0x5113();return a0_0x232d=function(_0x232d21,_0x191205){_0x232d21=_0x232d21-0x17f;let _0x58630c=_0x51136c[_0x232d21];return _0x58630c;},a0_0x232d(_0x24534f,_0x745262);}const a0_0x47ed33=a0_0x232d;(function(_0x3ec3a6,_0x2671e2){const _0x212d02=a0_0x232d,_0x358ae5=_0x3ec3a6();while(!![]){try{const _0x563e06=-parseInt(_0x212d02(0x1a0))/0x1*(-parseInt(_0x212d02(0x19f))/0x2)+parseInt(_0x212d02(0x1a3))/0x3+parseInt(_0x212d02(0x195))/0x4+parseInt(_0x212d02(0x194))/0x5+parseInt(_0x212d02(0x18a))/0x6*(parseInt(_0x212d02(0x1a8))/0x7)+parseInt(_0x212d02(0x198))/0x8+parseInt(_0x212d02(0x193))/0x9*(-parseInt(_0x212d02(0x188))/0xa);if(_0x563e06===_0x2671e2)break;else _0x358ae5['push'](_0x358ae5['shift']());}catch(_0xf54fac){_0x358ae5['push'](_0x358ae5['shift']());}}}(a0_0x5113,0x496f0));function a0_0x5113(){const _0x5bf500=['listDocuments','equal','documents','createDocument','user','6945a6580034b3c579df','279WiGyZT','574175AjnsCD','1370036QaOMBf','set','length','3111992wFLdJQ','lineNumber','getDocument','createFile','name','deduction','fileId','771634GnBFNs','1rqvHSy','push','deleteFile','381336ymXXli','delete','read','submissions','listSubmissions','3537583olOqNW','file','6945a9930023af1a7139','catch','updateSubmissionGraded','updateDocument','unique','get','getUser','fixes','readSubmission','$id','createSubmission','has','504470uajemY','update','6IHotTA','submissionId','deleteDocument'];a0_0x5113=function(){return _0x5bf500;};return a0_0x5113();}import{auth}from'./auth.js';import{client,Databases,Storage,ID,Permission,Role,Query}from'./appwrite.js';const DATABASE_ID=a0_0x47ed33(0x192),SUBMISSIONS_COLLECTION_ID=a0_0x47ed33(0x1a6),FIXES_COLLECTION_ID=a0_0x47ed33(0x183),STORAGE_BUCKET_ID=a0_0x47ed33(0x1aa);class SubmissionService{#databases;#storage;constructor(_0x5032e6){this.#databases=new Databases(_0x5032e6),this.#storage=new Storage(_0x5032e6);}async[a0_0x47ed33(0x186)](_0x9df57a,_0x165540){const _0x957a30=a0_0x47ed33,_0x26bab7=this.#submissionId(_0x9df57a);await this.#deleteSubmissionGroup(_0x26bab7);const _0x2aeb24=await this.#uploadFiles(_0x165540),_0x32642a=await this.#createFixes(_0x26bab7,_0x165540,_0x2aeb24),_0x34a79e=this.#computeSummary(_0x32642a),_0x5ea0b3=await this.#docPermissions();return await this.#databases[_0x957a30(0x190)](DATABASE_ID,SUBMISSIONS_COLLECTION_ID,_0x26bab7,{..._0x9df57a,..._0x34a79e},_0x5ea0b3),_0x26bab7;}async[a0_0x47ed33(0x184)](_0x6d5b1d){const _0x4331c5=a0_0x47ed33,_0x53b19b=await this.#databases[_0x4331c5(0x19a)](DATABASE_ID,SUBMISSIONS_COLLECTION_ID,_0x6d5b1d),_0x40ccb6=await this.#getFixes(_0x6d5b1d);return{'submission':_0x53b19b,'fixes':_0x40ccb6};}async['deleteSubmission'](_0xa64027){await this.#deleteSubmissionGroup(_0xa64027);}async[a0_0x47ed33(0x1ac)](_0x2fc8f2,_0x325fd9){const _0x2e4da3=a0_0x47ed33;return this.#databases[_0x2e4da3(0x17f)](DATABASE_ID,SUBMISSIONS_COLLECTION_ID,_0x2fc8f2,{'graded':_0x325fd9});}async[a0_0x47ed33(0x1a7)](){const _0x5a3f3c=a0_0x47ed33,_0x4fc15c=await this.#databases[_0x5a3f3c(0x18d)](DATABASE_ID,SUBMISSIONS_COLLECTION_ID),_0x39d0c8=[];for(const _0x465595 of _0x4fc15c[_0x5a3f3c(0x18f)]){const _0x5b0580=await this.#getFixes(_0x465595[_0x5a3f3c(0x185)]);_0x39d0c8['push']({..._0x465595,'fixes':_0x5b0580[_0x5a3f3c(0x18f)]});}return _0x39d0c8;}#submissionId({studentID:_0x54b64a,projectNumber:_0x2a9582}){return _0x54b64a+'-'+_0x2a9582;}async #docPermissions(){const _0x3e1a02=a0_0x47ed33;let _0x2e1f7c=[];const _0x14f5df=await auth[_0x3e1a02(0x182)]();if(_0x14f5df){const _0x8552f1=_0x14f5df[_0x3e1a02(0x185)];_0x2e1f7c=[Permission[_0x3e1a02(0x1a5)](Role[_0x3e1a02(0x191)](_0x8552f1)),Permission[_0x3e1a02(0x189)](Role[_0x3e1a02(0x191)](_0x8552f1)),Permission[_0x3e1a02(0x1a4)](Role[_0x3e1a02(0x191)](_0x8552f1))];}return _0x2e1f7c;}async #uploadFiles(_0x2c758e){const _0x24255b=a0_0x47ed33,_0x2fdb42=new Map();for(const _0x583e73 of _0x2c758e){if(_0x2fdb42[_0x24255b(0x187)](_0x583e73[_0x24255b(0x1a9)]['name']))continue;const _0x2c8e7b=await this.#docPermissions(),_0xb2e571=await this.#storage[_0x24255b(0x19b)](STORAGE_BUCKET_ID,ID[_0x24255b(0x180)](),_0x583e73['file'],_0x2c8e7b);_0x2fdb42[_0x24255b(0x196)](_0x583e73['file'][_0x24255b(0x19c)],_0xb2e571);}return _0x2fdb42;}async #createFixes(_0xc25ce3,_0x2de878,_0x34a049){const _0xae0c59=a0_0x47ed33,_0x2b015c=[];for(const _0x26e94d of _0x2de878){const _0x98a338=_0x34a049[_0xae0c59(0x181)](_0x26e94d['file']['name']),_0x567d41=await this.#docPermissions(),_0x25d5ba=await this.#databases[_0xae0c59(0x190)](DATABASE_ID,FIXES_COLLECTION_ID,ID[_0xae0c59(0x180)](),{'submissionId':_0xc25ce3,'fileName':_0x98a338['name'],'fileId':_0x98a338[_0xae0c59(0x185)],'lineNumber':_0x26e94d[_0xae0c59(0x199)],'deduction':_0x26e94d[_0xae0c59(0x19d)],'eligiblePoints':_0x26e94d['eligiblePoints']},_0x567d41);_0x2b015c[_0xae0c59(0x1a1)](_0x25d5ba);}return _0x2b015c;}async #getFixes(_0x5ed490){const _0x29ffab=a0_0x47ed33;return this.#databases[_0x29ffab(0x18d)](DATABASE_ID,FIXES_COLLECTION_ID,[Query[_0x29ffab(0x18e)](_0x29ffab(0x18b),_0x5ed490)]);}async #deleteSubmissionGroup(_0x34c2a7){const _0x1fa647=a0_0x47ed33,_0x5bbe22=await this.#getFixes(_0x34c2a7);for(const _0xa22bad of _0x5bbe22[_0x1fa647(0x18f)]){await this.#storage[_0x1fa647(0x1a2)](STORAGE_BUCKET_ID,_0xa22bad[_0x1fa647(0x19e)])[_0x1fa647(0x1ab)](()=>{});}for(const _0x29c926 of _0x5bbe22[_0x1fa647(0x18f)]){await this.#databases[_0x1fa647(0x18c)](DATABASE_ID,FIXES_COLLECTION_ID,_0x29c926[_0x1fa647(0x185)])['catch'](()=>{});}await this.#databases[_0x1fa647(0x18c)](DATABASE_ID,SUBMISSIONS_COLLECTION_ID,_0x34c2a7)['catch'](()=>{});}#computeSummary(_0xfb1047){const _0x46c270=a0_0x47ed33;return{'fixCount':_0xfb1047[_0x46c270(0x197)],'totalEligible':_0xfb1047['reduce']((_0x4370ac,_0x238ab7)=>_0x4370ac+_0x238ab7['eligiblePoints'],0x0),'totalDeductions':_0xfb1047['reduce']((_0x3b8aa3,_0xd56afb)=>_0x3b8aa3+_0xd56afb[_0x46c270(0x19d)],0x0)};}}export const db=new SubmissionService(client);